---
title: "Neuroimaging"
output: html_document
date: "2025-08-22"
---


# ANTS - ALL
```{r}
library(ppcor)

# ----- PARTIAL CORRELATION CONTROLLING FOR AGE, SEX, ICV -----

file_path <- "E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df<-na.omit(df)
df$Sex <- ifelse(df$Sex == "M", 1, 0)

# Define index groups
regions <- 1:40
tasks <- 41:45
conditioning_vars <- c(46, 47, 48)

# Create empty p-value matrix
all_pvals <- matrix(NA, nrow = 45, ncol = 45)
colnames(all_pvals) <- colnames(df)[1:45]
rownames(all_pvals) <- colnames(df)[1:45]


# Fill Region–Task p-values (both upper and lower triangle)
for (i in regions) {
  for (j in tasks) {
    result <- pcor.test(
      x = df[[i]],
      y = df[[j]],
      z = df[, conditioning_vars],
      method = "spearman"
    )
    all_pvals[i, j] <- result$p.value
    all_pvals[j, i] <- result$p.value  # symmetric
  }
}

# Fill Task–Task p-values
for (i in tasks) {
  for (j in tasks) {
    if (i != j) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
    } else {
      all_pvals[i, j] <- NA  # no self-correlation  
    }
  }
}

write.csv(all_pvals, "E:/liz/Defense/Neuroimaging/ants//BH_raw_pvals.csv", row.names = TRUE)


# ----- MULTIPLE COMPARISONS CORRECTION -----

# Extract unique Region–Task p-values (i in regions, j in tasks)
region_task_pvals <- c()
region_task_labels <- c()
for (i in regions) {
  for (j in tasks) {
    pval <- all_pvals[i, j]
    if (!is.na(pval)) {
      region_task_pvals <- c(region_task_pvals, pval)
      region_task_labels <- c(region_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
    }
  }
}

# Extract unique Task–Task p-values (upper triangle only)
task_task_pvals <- c()
task_task_labels <- c()
for (i in tasks) {
  for (j in tasks) {
    if (i < j) {
      pval <- all_pvals[i, j]
      if (!is.na(pval)) {
        task_task_pvals <- c(task_task_pvals, pval)
        task_task_labels <- c(task_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
      }
    }
  }
}

# Combine all unique p-values and labels
all_unique_pvals <- c(region_task_pvals, task_task_pvals)
all_labels <- c(region_task_labels, task_task_labels)

# Apply FDR correction
fdr_corrected_pvals <- p.adjust(all_unique_pvals, method = "BH")

# Save results to a data frame
correction_results <- data.frame(
  Comparison = all_labels,
  Raw_p = all_unique_pvals,
  FDR_p = fdr_corrected_pvals
)

# Write to CSV
write.csv(correction_results, "E:/liz/Defense/Neuroimaging/ants/BH_corrected_results.csv", row.names = FALSE)
```


```{r}
for (i in regions) {
  for (j in tasks) {

  }
}

df [, conditioning_vars]

data <- data.frame(a = 1:3, b = 4:6, c = 7:9)
all_pvals <- matrix(NA, nrow = 3, ncol = 3)

all_pvals[1, 2] = 2
print(all_pvals)

```


# ANTS - Males Females

```{r, warning=FALSE}
library(ppcor)


# ----- PARTIAL CORRELATION CONTROLLING FOR AGE, SEX, ICV -----

file_path <- "E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df$Sex <- ifelse(df$Sex == "M", 1, 0)
df <- na.omit(df)

# Index groups
regions <- 1:40
tasks <- 41:45
conditioning_vars <- c(46, 47, 48)

# Split data by sex
df_male <- df[df$Sex == 1, ]
df_female <- df[df$Sex == 0, ]

# Function to compute partial p-value matrix
compute_pvals <- function(df) {
  all_pvals <- matrix(NA, nrow = 45, ncol = 45)
  colnames(all_pvals) <- colnames(df)[1:45]
  rownames(all_pvals) <- colnames(df)[1:45]

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
      all_pvals[j, i] <- result$p.value
    }
  }

  # Task–Task
  for (i in tasks) {
    for (j in tasks) {
      if (i != j) {
        result <- pcor.test(
          x = df[[i]],
          y = df[[j]],
          z = df[, conditioning_vars],
          method = "spearman"
        )
        all_pvals[i, j] <- result$p.value
      } else {
        all_pvals[i, j] <- NA
      }
    }
  }

  return(all_pvals)
}

# Function to extract unique p-values and apply FDR correction
correct_pvals <- function(pval_matrix, sex_label) {
  comparison_labels <- c()
  raw_pvals <- c()

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      pval <- pval_matrix[i, j]
      if (!is.na(pval)) {
        label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
        comparison_labels <- c(comparison_labels, label)
        raw_pvals <- c(raw_pvals, pval)
      }
    }
  }

  # Task–Task (upper triangle)
  for (i in tasks) {
    for (j in tasks) {
      if (i < j) {
        pval <- pval_matrix[i, j]
        if (!is.na(pval)) {
          label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
          comparison_labels <- c(comparison_labels, label)
          raw_pvals <- c(raw_pvals, pval)
        }
      }
    }
  }

  fdr_corrected <- p.adjust(raw_pvals, method = "BH")

  result_df <- data.frame(
    Comparison = comparison_labels,
    Raw_p = raw_pvals,
    FDR_p = fdr_corrected
  )

  write.csv(result_df,
            paste0("E:/liz/Defense/Neuroimaging/ants/BH_corrected_results_", sex_label, ".csv"),
            row.names = FALSE)

  return(result_df)
}

# Run for males
pvals_male <- compute_pvals(df_male)
corrected_male <- correct_pvals(pvals_male, "male")

# Run for females
pvals_female <- compute_pvals(df_female)
corrected_female <- correct_pvals(pvals_female, "female")

```



# FS - ALL
```{r}
library(ppcor)

# Load and clean data
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df<-na.omit(df)
df$Sex <- ifelse(df$Sex == "M", 1, 0)

# Define index groups
regions <- 1:66
tasks <- 67:71
conditioning_vars <- c(72, 73, 74)

# Create empty p-value matrix
all_pvals <- matrix(NA, nrow = 71, ncol = 71)
colnames(all_pvals) <- colnames(df)[1:71]
rownames(all_pvals) <- colnames(df)[1:71]

# Fill Region–Task p-values (both upper and lower triangle)
for (i in regions) {
  for (j in tasks) {
    result <- pcor.test(
      x = df[[i]],
      y = df[[j]],
      z = df[, conditioning_vars],
      method = "spearman"
    )
    all_pvals[i, j] <- result$p.value
    all_pvals[j, i] <- result$p.value  # symmetric
  }
}

# Fill Task–Task p-values
for (i in tasks) {
  for (j in tasks) {
    if (i != j) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
    } else {
      all_pvals[i, j] <- NA  # no self-correlation  
    }
  }
}

write.csv(all_pvals, "E:/liz/Defense/Neuroimaging/freesurfer/BH_raw_results.csv", row.names = TRUE)

# ----- MULTIPLE COMPARISONS CORRECTION -----

# Extract unique Region–Task p-values (i in regions, j in tasks)
region_task_pvals <- c()
region_task_labels <- c()
for (i in regions) {
  for (j in tasks) {
    pval <- all_pvals[i, j]
    if (!is.na(pval)) {
      region_task_pvals <- c(region_task_pvals, pval)
      region_task_labels <- c(region_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
    }
  }
}

# Extract unique Task–Task p-values (upper triangle only)
task_task_pvals <- c()
task_task_labels <- c()
for (i in tasks) {
  for (j in tasks) {
    if (i < j) {
      pval <- all_pvals[i, j]
      if (!is.na(pval)) {
        task_task_pvals <- c(task_task_pvals, pval)
        task_task_labels <- c(task_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
      }
    }
  }
}

# Combine all unique p-values and labels
all_unique_pvals <- c(region_task_pvals, task_task_pvals)
all_labels <- c(region_task_labels, task_task_labels)

# Apply FDR correction
fdr_corrected_pvals <- p.adjust(all_unique_pvals, method = "BH")

# Save results to a data frame
correction_results <- data.frame(
  Comparison = all_labels,
  Raw_p = all_unique_pvals,
  FDR_p = fdr_corrected_pvals
)

# Write to CSV
write.csv(correction_results, "E:/liz/Defense/Neuroimaging/freesurfer/BH_corrected_results.csv", row.names = FALSE)


```


# FS - males and females
```{r, warning=FALSE}
library(ppcor)

# Load and clean data
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df$Sex <- ifelse(df$Sex == "M", 1, 0)
df <- na.omit(df)

# Index groups
regions <- 1:66
tasks <- 67:71
conditioning_vars <- c(72, 73, 74)

# Split data by sex
df_male <- df[df$Sex == 1, ]
df_female <- df[df$Sex == 0, ]

# Function to compute partial p-value matrix
compute_pvals <- function(df) {
  all_pvals <- matrix(NA, nrow = 71, ncol = 71)
  colnames(all_pvals) <- colnames(df)[1:71]
  rownames(all_pvals) <- colnames(df)[1:71]

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
      all_pvals[j, i] <- result$p.value
    }
  }

  # Task–Task
  for (i in tasks) {
    for (j in tasks) {
      if (i != j) {
        result <- pcor.test(
          x = df[[i]],
          y = df[[j]],
          z = df[, conditioning_vars],
          method = "spearman"
        )
        all_pvals[i, j] <- result$p.value
      } else {
        all_pvals[i, j] <- NA
      }
    }
  }

  return(all_pvals)
}

# Function to extract unique p-values and apply FDR correction
correct_pvals <- function(pval_matrix, sex_label) {
  comparison_labels <- c()
  raw_pvals <- c()

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      pval <- pval_matrix[i, j]
      if (!is.na(pval)) {
        label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
        comparison_labels <- c(comparison_labels, label)
        raw_pvals <- c(raw_pvals, pval)
      }
    }
  }

  # Task–Task (upper triangle)
  for (i in tasks) {
    for (j in tasks) {
      if (i < j) {
        pval <- pval_matrix[i, j]
        if (!is.na(pval)) {
          label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
          comparison_labels <- c(comparison_labels, label)
          raw_pvals <- c(raw_pvals, pval)
        }
      }
    }
  }

  fdr_corrected <- p.adjust(raw_pvals, method = "BH")

  result_df <- data.frame(
    Comparison = comparison_labels,
    Raw_p = raw_pvals,
    FDR_p = fdr_corrected
  )

  write.csv(result_df,
            paste0("E:/liz/Defense/Neuroimaging/freesurfer/BH_corrected_results_", sex_label, ".csv"),
            row.names = FALSE)

  return(result_df)
}

# Run for males
pvals_male <- compute_pvals(df_male)
corrected_male <- correct_pvals(pvals_male, "male")

# Run for females
pvals_female <- compute_pvals(df_female)
corrected_female <- correct_pvals(pvals_female, "female")


```


# FS - ROI
```{r, warning=FALSE}
library(ppcor)

# Load and clean data
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df<-na.omit(df)
df$Sex <- ifelse(df$Sex == "M", 1, 0)

# Define index groups
regions <- 1:16
tasks <- 17:21
conditioning_vars <- c(22, 23, 24)

# Create empty p-value matrix
all_pvals <- matrix(NA, nrow = 21, ncol = 21)
colnames(all_pvals) <- colnames(df)[1:21]
rownames(all_pvals) <- colnames(df)[1:21]

# Fill Region–Task p-values (both upper and lower triangle)
for (i in regions) {
  for (j in tasks) {
    result <- pcor.test(
      x = df[[i]],
      y = df[[j]],
      z = df[, conditioning_vars],
      method = "spearman"
    )
    all_pvals[i, j] <- result$p.value
    all_pvals[j, i] <- result$p.value  # symmetric
  }
}

# Fill Task–Task p-values
for (i in tasks) {
  for (j in tasks) {
    if (i != j) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
    } else {
      all_pvals[i, j] <- NA  # no self-correlation  
    }
  }
}

write.csv(all_pvals, "E:/liz/Defense/Neuroimaging/freesurfer/ROI_BH_raw_results.csv", row.names = TRUE)

# ----- MULTIPLE COMPARISONS CORRECTION -----

# Extract unique Region–Task p-values (i in regions, j in tasks)
region_task_pvals <- c()
region_task_labels <- c()
for (i in regions) {
  for (j in tasks) {
    pval <- all_pvals[i, j]
    if (!is.na(pval)) {
      region_task_pvals <- c(region_task_pvals, pval)
      region_task_labels <- c(region_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
    }
  }
}

# Extract unique Task–Task p-values (upper triangle only)
task_task_pvals <- c()
task_task_labels <- c()
for (i in tasks) {
  for (j in tasks) {
    if (i < j) {
      pval <- all_pvals[i, j]
      if (!is.na(pval)) {
        task_task_pvals <- c(task_task_pvals, pval)
        task_task_labels <- c(task_task_labels,
                              paste0(rownames(all_pvals)[i], " vs ", colnames(all_pvals)[j]))
      }
    }
  }
}

# Combine all unique p-values and labels
all_unique_pvals <- c(region_task_pvals, task_task_pvals)
all_labels <- c(region_task_labels, task_task_labels)

# Apply FDR correction
fdr_corrected_pvals <- p.adjust(all_unique_pvals, method = "BH")

# Save results to a data frame
correction_results <- data.frame(
  Comparison = all_labels,
  Raw_p = all_unique_pvals,
  FDR_p = fdr_corrected_pvals
)

# Write to CSV
write.csv(correction_results, "E:/liz/Defense/Neuroimaging/freesurfer/ROI_BH_corrected_results.csv", row.names = FALSE)
```



# FS-ROI- males females
```{r, warning=FALSE}
library(ppcor)

# Load and clean data
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df <- read.csv(file_path)
df <- df[, !(names(df) %in% "ID")]
df$Sex <- ifelse(df$Sex == "M", 1, 0)
df <- na.omit(df)

# Index groups
regions <- 1:16
tasks <- 17:21
conditioning_vars <- c(22, 23, 24)

# Split data by sex
df_male <- df[df$Sex == 1, ]
df_female <- df[df$Sex == 0, ]

# Function to compute partial p-value matrix
compute_pvals <- function(df) {
  all_pvals <- matrix(NA, nrow = 21, ncol = 21)
  colnames(all_pvals) <- colnames(df)[1:21]
  rownames(all_pvals) <- colnames(df)[1:21]

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      result <- pcor.test(
        x = df[[i]],
        y = df[[j]],
        z = df[, conditioning_vars],
        method = "spearman"
      )
      all_pvals[i, j] <- result$p.value
      all_pvals[j, i] <- result$p.value
    }
  }

  # Task–Task
  for (i in tasks) {
    for (j in tasks) {
      if (i != j) {
        result <- pcor.test(
          x = df[[i]],
          y = df[[j]],
          z = df[, conditioning_vars],
          method = "spearman"
        )
        all_pvals[i, j] <- result$p.value
      } else {
        all_pvals[i, j] <- NA
      }
    }
  }

  return(all_pvals)
}

# Function to extract unique p-values and apply FDR correction
correct_pvals <- function(pval_matrix, sex_label) {
  comparison_labels <- c()
  raw_pvals <- c()

  # Region–Task
  for (i in regions) {
    for (j in tasks) {
      pval <- pval_matrix[i, j]
      if (!is.na(pval)) {
        label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
        comparison_labels <- c(comparison_labels, label)
        raw_pvals <- c(raw_pvals, pval)
      }
    }
  }

  # Task–Task (upper triangle)
  for (i in tasks) {
    for (j in tasks) {
      if (i < j) {
        pval <- pval_matrix[i, j]
        if (!is.na(pval)) {
          label <- paste0(rownames(pval_matrix)[i], " vs ", colnames(pval_matrix)[j])
          comparison_labels <- c(comparison_labels, label)
          raw_pvals <- c(raw_pvals, pval)
        }
      }
    }
  }

  fdr_corrected <- p.adjust(raw_pvals, method = "BH")

  result_df <- data.frame(
    Comparison = comparison_labels,
    Raw_p = raw_pvals,
    FDR_p = fdr_corrected
  )

  write.csv(result_df,
            paste0("E:/liz/Defense/Neuroimaging/freesurfer/ROI_BH_corrected_results_", sex_label, ".csv"),
            row.names = FALSE)

  return(result_df)
}

# Run for males
pvals_male <- compute_pvals(df_male)
corrected_male <- correct_pvals(pvals_male, "male")

# Run for females
pvals_female <- compute_pvals(df_female)
corrected_female <- correct_pvals(pvals_female, "female")

```


```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = PFT, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "PFT",
    y = "MRT"
  ) +
  theme_minimal()


```

```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT_z, y = iVTT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "iVTT"
  ) +
  theme_minimal()


```

```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT, y = RMT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "RMT"
  ) +
  theme_minimal()

```


```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$RMT_z <- scale(df$RMT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = RMT_z, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RMT",
    y = "MRT"
  ) +
  theme_minimal()
```


```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "MRT"
  ) +
  theme_minimal()
```
```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_DorsAttn_PrCv , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "LH_DorsAttn_PrCv",
    y = "MRT"
  ) +
  theme_minimal()

```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_Default_pCunPCC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "LH_Default_pCunPCC",
    y = "MRT"
  ) +
  theme_minimal()
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =RH_Default_PFC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_PFC",
    y = "MRT"
  ) +
  theme_minimal()
```



```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =RH_Default_pCunPCC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_pCunPCC",
    y = "MRT"
  ) +
  theme_minimal()
```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_Default_pCunPCC , y = RMT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_pCunPCC",
    y = "PFT"
  ) +
  theme_minimal()
```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_Cont_PFCmp , y = PFT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_pCunPCC",
    y = "PFT"
  ) +
  theme_minimal()

```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_Default_PFC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_pCunPCC",
    y = "PFT"
  ) +
  theme_minimal()
```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =RH_Cont_pCun , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Cont_pCun",
    y = "MRT"
  ) +
  theme_minimal()

```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =RH_DorsAttn_PrCv , y = PFT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_DorsAttn_PrCv",
    y = "PFT"
  ) +
  theme_minimal()
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_DorsAttn_PrCv , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_DorsAttn_PrCv",
    y = "MRT"
  ) +
  theme_minimal()

```

```{r}
library(ggstatsplot)
library(ggplot2)

file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Scatter plot with regression line
ggplot(df, aes(x = LH_DorsAttn_PrCv, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +  # regression line
  labs(
    title = "Scatter Plot of LH_DorsAttn_PrCv vs MRT",
    x = "LH_DorsAttn_PrCv",
    y = "MRT"
  ) +
  theme_minimal()
```


```{r}

library(ggstatsplot)
library(ggplot2)

file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Scatter plot with regression line
ggplot(df, aes(x = RH_Default_pCunPCC, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +  # regression line
  labs(
    title = "Scatter Plot of RH_Default_pCunPCC vs MRT",
    x = "RH_Default_pCunPCC",
    y = "MRT"
  ) +
  theme_minimal()
```
```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$RH_Default_pCunPCC, df$MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "RH_Default_pCunPCC", 
  y = "MRT", 
  type = "nonparametric",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```
```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$LH_DorsAttn_PrCv, df$MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "LH_DorsAttn_PrCv", 
  y = "MRT", 
  type = "nonparametric",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```

```{r}
library(ppcor)

file_path <- "E:/liz/Advancement/GMV/modified_data_hippo_subfields.csv"
df <- read.csv(file_path)
df <- df[, -1] # remove ID
df <- na.omit(df)
df$Sex <- ifelse(df$Sex == "M", 1, 0) 

# Compute partial correlation p-values
partial_corr_control_sex <- sapply(1:(ncol(df)-3), function(x) 
  sapply(1:(ncol(df)-3), function(y) {
    if (x == y) NA
    else pcor.test(df[,x], df[,y], df[,(ncol(df)-2):ncol(df)], method="spearman")$p.value
  })
)

# Add row/col names
column_names <- colnames(df)[1:(ncol(df) - 3)]
colnames(partial_corr_control_sex) <- column_names
rownames(partial_corr_control_sex) <- column_names

# ----- MULTIPLE COMPARISONS CORRECTION -----

# Extract upper triangle (unique tests)
ut <- upper.tri(partial_corr_control_sex)
pvals <- partial_corr_control_sex[ut]

# Correct with Benjamini–Hochberg
pvals_fdr <- p.adjust(pvals, method = "BH")

# Rebuild full symmetric matrix of adjusted p-values
adj_mat <- matrix(NA, nrow = ncol(partial_corr_control_sex), 
                  ncol = ncol(partial_corr_control_sex),
                  dimnames = dimnames(partial_corr_control_sex))
adj_mat[ut] <- pvals_fdr
adj_mat[lower.tri(adj_mat)] <- t(adj_mat)[lower.tri(adj_mat)]
diag(adj_mat) <- NA

# Save both raw and corrected p-values
write.csv(partial_corr_control_sex, "E:/liz/Defense/Neuroimaging/rrrrrrrrpartialcorr_pvals.csv", row.names = TRUE)
write.csv(adj_mat, "E:/liz/Defense/Neuroimaging/rrrrrrrrrrrrrr_pvals.csv", row.names = TRUE)



```





## plot significant results
```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$LH_DorsAttn_PrCv, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "LH_DorsAttn_PrCv", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```

```{r}
library(ggplot2)
library(ggpubr)
library(dplyr)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
df$Sex <- ifelse(df$Sex == "M", "Males", "Females") 
df %>% 
  ggplot(aes(x = LH_DorsAttn_PrCv, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point(alpha = 0.8, size = 1.8) +
  geom_smooth(method = 'lm', colour = 'black') +
  facet_wrap(~ Sex) +
  labs(colour = 'Sex') + 
  stat_cor(method = "spearman", label.x = 2.5, label.y = 2, colour = 'black')+
  theme_classic(base_size = 12) +                           # <- white background
  theme(strip.background = element_rect(fill = "white"))    # <- white strip labels
```

