---
title: "Neuroimaging"
output: html_document
date: "2025-08-22"
---

```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = PFT, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "PFT",
    y = "MRT"
  ) +
  theme_minimal()

```

```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT_z, y = iVTT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "iVTT"
  ) +
  theme_minimal()


```

```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT, y = RMT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "RMT"
  ) +
  theme_minimal()

```


```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$RMT_z <- scale(df$RMT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = RMT_z, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RMT",
    y = "MRT"
  ) +
  theme_minimal()
```


```{r}
file_path <- "E:/liz/Defense/Behavioral/Behavioral.csv"
df <- read.csv(file_path)

df$SOT_z <- scale(df$SOT)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x = SOT, y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "SOT",
    y = "MRT"
  ) +
  theme_minimal()
```
```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_DorsAttn_PrCv , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "LH_DorsAttn_PrCv",
    y = "MRT"
  ) +
  theme_minimal()

```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =LH_Default_pCunPCC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "LH_Default_pCunPCC",
    y = "MRT"
  ) +
  theme_minimal()
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40.csv"
df <- read.csv(file_path)

# Basic scatter plot for RMT vs iVTT
ggplot(df, aes(x =RH_Default_PFC , y = MRT)) +
  geom_point(color = "blue", size = 2, alpha = 0.7) +
  labs(
    title = "Scatter Plot of RMT vs iVTT",
    x = "RH_Default_PFC",
    y = "MRT"
  ) +
  theme_minimal()
```



## plot significant results
```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$LH_DorsAttn_PrCv, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "LH_DorsAttn_PrCv", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1, axis.text.x = element_text(size = 16),  # <- bigger x-axis numbers
      axis.text.y = element_text(size = 16)))  
)
```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = LH_DorsAttn_PrCv_mean, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
table(df$Sex)

```


```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$RH_Default_PFC, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "RH_Default_PFC", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)

```




```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$LH_SalVentAttn_FrOperIns_mean, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "LH_SalVentAttn_FrOperIns_mean", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```


```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = LH_SalVentAttn_FrOperIns_mean, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
table(df$Sex)
```

```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$RH_Default_pCunPCC_mean, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "RH_Default_pCunPCC_mean", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = RH_Default_pCunPCC_mean, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
```

```{r}
# Load CSV
df <- read.csv("E:/liz/Defense/ants_nodes.csv")

# Make sure columns are named properly
colnames(df) <- c("id", "label", "x", "y", "z")

# Add BrainNet-required columns
df$size <- 3      # size of node (adjust if needed)
df$color <- 1     # color index (same color for all)

# Reorder for BrainNet: x y z size color label
node <- df[, c("x", "y", "z", "size", "color", "label")]

# Save as .node (tab separated, no headers)
write.table(node,
            "E:/liz/Defense/visual_nodes.node",
            quote = FALSE, sep = "\t",
            row.names = FALSE, col.names = FALSE)

```


```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)
# limbic and control
cor.test(df$RH_Default_PFCv_mean, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "RH_Default_PFCv_mean", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/ants_Ct_40_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = RH_Default_PFCv_mean, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
table(df$Sex)
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = lh.precuneus, y = winsorized_MRT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
table(df$Sex)
```

```{r}
library(ggstatsplot)
file_path<-"E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df<-read.csv(file_path)
df<-na.omit(df)

# limbic and control
cor.test(df$lh.precuneus, df$winsorized_MRT, method = "spearman")
ggscatterstats(
  data = df, 
  x = "lh.precuneus", 
  y = "winsorized_MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # Makes the plot square
)
```

```{r}
file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df <- read.csv(file_path) |> na.omit()
df$Sex <- ifelse(df$Sex == "M", "Males", "Females")

df %>%
  ggplot(aes(x = lh.isthmuscingulate, y = winsorized_iVTT, colour = factor(Sex))) +
  geom_point() +
  geom_smooth(method = "lm", colour = "black") +
  facet_wrap(~ Sex) +
  labs(colour = "Sex") +
  stat_cor(
    method = "spearman",
    label.stat = c("rho", "p"),  # show rho and p
    colour = "black",
    parse = FALSE,
    label.x.npc = "left",        # relative position: "left", "center", "right"
    label.y.npc = "top",         # relative position: "bottom", "center", "top"
    size = 2                     # make text larger
  ) +
  theme_classic(base_size = 14) +
  theme(strip.background = element_rect(fill = "white"))
table(df$Sex)
```

```{r}
library(ggstatsplot)

file_path <- "E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv"
df <- read.csv(file_path)
df <- na.omit(df)

# Keep only females (adjust value if it's coded differently, e.g. "Female" or 0/1)
#df <- subset(df, Sex == "F")

# correlation
cor.test(df$lh.precuneus, df$MRT, method = "spearman")

# plot
ggscatterstats(
  data = df, 
  x = "lh.precuneus", 
  y = "MRT", 
  type = "nonparametric",
  marginal.type = "density",
  ggplot.component = list(ggplot2::theme(aspect.ratio = 1))  # square plot
)

```




                  ################ corr between CT and GMV and tasks #################
                  
## Main scripts for partial correlations and multiple comparison correction
# GMV - ROI - pairwise N
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_cov.csv")  # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[ , !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[ , !(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[ , !(names(df_cov)   %in% "ID")]

df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)


# --- Define groups ---
region_cols <- c("LCA2.3","LDG","RCA2.3","RDG")  

task_cols   <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
                 "winsorized_iVTT","winsorized_RMT")
cov_cols    <- c("Age","Sex","Volume")          

# quick checks (fail fast if something is misspelled)
stopifnot(all(region_cols %in% names(df_all)))
stopifnot(all(task_cols   %in% names(df_tasks)))
stopifnot(all(cov_cols    %in% names(df_cov)))

# --- Containers for results ---
labs  <- c()
pvec  <- c()
rho   <- c()
Ns    <- c()

# --- TASK–TASK (within df_tasks) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {

    x <- df_tasks[[task_cols[i]]]
    y <- df_tasks[[task_cols[j]]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    idx <- complete.cases(x, y, Z)
    res <- pcor.test(x[idx], y[idx], Z[idx, , drop = FALSE], method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   sum(idx))
    
  }
}

# --- TASK–REGION (tasks from df_tasks, regions from df_all) ---
for (t in task_cols) {
  for (r in region_cols) {

    x <- df_tasks[[t]]      # task
    y <- df_all[[r]]        # region
    Z <- df_cov[, cov_cols, drop = FALSE]

    idx <- complete.cases(x, y, Z)
    res <- pcor.test(x[idx], y[idx], Z[idx, , drop = FALSE], method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   sum(idx))
    
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/ROI_BH_results.csv", row.names = FALSE)

```



# GMV - all - pairwise N
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_cov.csv")  # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[ , !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[ , !(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[ , !(names(df_cov)   %in% "ID")]

df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)


# --- Define groups ---
region_cols <- c("LHC","LCA1","LCA2.3","LDG","LSUB", "LERC","LPRC", "LPHC",
                 "RHC", "RCA1", "RCA2.3", "RDG", "RSUB", "RERC", 
                 "RPRC", "RPHC", "TotHC")  

task_cols   <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
                 "winsorized_iVTT","winsorized_RMT")

cov_cols    <- c("Age","Sex","Volume")           

# quick checks (fail fast if something is misspelled)
stopifnot(all(region_cols %in% names(df_all)))
stopifnot(all(task_cols   %in% names(df_tasks)))
stopifnot(all(cov_cols    %in% names(df_cov)))

# --- Containers for results ---
labs  <- c()
pvec  <- c()
rho   <- c()
Ns    <- c()

# --- TASK–TASK (within df_tasks) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {

    x <- df_tasks[[task_cols[i]]]
    y <- df_tasks[[task_cols[j]]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    idx <- complete.cases(x, y, Z)
    res <- pcor.test(x[idx], y[idx], Z[idx, , drop = FALSE], method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   sum(idx))
    
  }
}

# --- TASK–REGION (tasks from df_tasks, regions from df_all) ---
for (t in task_cols) {
  for (r in region_cols) {

    x <- df_tasks[[t]]      # task
    y <- df_all[[r]]        # region
    Z <- df_cov[, cov_cols, drop = FALSE]

    idx <- complete.cases(x, y, Z)
    res <- pcor.test(x[idx], y[idx], Z[idx, , drop = FALSE], method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   sum(idx))
    
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/BH_results.csv", row.names = FALSE)


```



# Freesurfer - all - fixed N
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_cov.csv")  # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups (use exact column names) ---
region_cols <- c("rh.caudalanteriorcingulate","rh.caudalmiddlefrontal","rh.cuneus",
  "rh.entorhinal","rh.fusiform","rh.inferiorparietal","rh.inferiortemporal",
  "rh.isthmuscingulate","rh.lateraloccipital","rh.lateralorbitofrontal",
  "rh.lingual","rh.medialorbitofrontal","rh.middletemporal",
  "rh.parahippocampal","rh.paracentral","rh.parsopercularis","rh.parsorbitalis",
  "rh.parstriangularis","rh.pericalcarine","rh.postcentral",
  "rh.posteriorcingulate","rh.precentral","rh.precuneus",
  "rh.rostralanteriorcingulate","rh.rostralmiddlefrontal","rh.superiorfrontal",
  "rh.superiorparietal","rh.superiortemporal","rh.supramarginal",
  "rh.frontalpole","rh.temporalpole","rh.transversetemporal","rh.insula",
  "lh.caudalanteriorcingulate","lh.caudalmiddlefrontal","lh.cuneus",
  "lh.entorhinal","lh.fusiform","lh.inferiorparietal","lh.inferiortemporal",
  "lh.isthmuscingulate","lh.lateraloccipital","lh.lateralorbitofrontal",
  "lh.lingual","lh.medialorbitofrontal","lh.middletemporal",
  "lh.parahippocampal","lh.paracentral","lh.parsopercularis","lh.parsorbitalis",
  "lh.parstriangularis","lh.pericalcarine","lh.postcentral",
  "lh.posteriorcingulate","lh.precentral","lh.precuneus",
  "lh.rostralanteriorcingulate","lh.rostralmiddlefrontal","lh.superiorfrontal",
  "lh.superiorparietal","lh.superiortemporal","lh.supramarginal",
  "lh.frontalpole","lh.temporalpole","lh.transversetemporal","lh.insula")

task_cols   <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
                 "winsorized_iVTT","winsorized_RMT")

cov_cols    <- c("Age","Sex","Volume")

# Quick checks
stopifnot(all(region_cols %in% names(df_all)))
stopifnot(all(task_cols   %in% names(df_tasks)))
stopifnot(all(cov_cols    %in% names(df_cov)))

# ===== FIXED-N LISTWISE DELETION ACROSS ALL VARS =====
mask <- complete.cases(
  df_all[,   region_cols, drop = FALSE],
  df_tasks[, task_cols,   drop = FALSE],
  df_cov[,   cov_cols,    drop = FALSE]
)

df_all   <- df_all[mask, ]
df_tasks <- df_tasks[mask, ]
df_cov   <- df_cov[mask, ]
N_global <- nrow(df_cov)   # same for all tests

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks[[task_cols[i]]]
    y <- df_tasks[[task_cols[j]]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks[[t]]
    y <- df_all[[r]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/BH_results.csv", row.names = FALSE)
```


# Freesurfer - ROI - fixed N
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_cov.csv")  # Age, Sex, Volume (ICV)
# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups (use exact column names) ---
region_cols <- c("rh.supramarginal","rh.precuneus","rh.precentral","rh.nferiorparietal",
  "rh.isthmuscingulate","rh.superiorparietal","rh.superiortemporal",
  "rh.posteriorcingulate","lh.supramarginal","lh.precuneus","lh.precentral",
  "lh.nferiorparietal","lh.isthmuscingulate","lh.superiorparietal",
  "lh.superiortemporal","lh.posteriorcingulate")

task_cols   <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
                 "winsorized_iVTT","winsorized_RMT")

cov_cols    <- c("Age","Sex","Volume")

# Quick checks
stopifnot(all(region_cols %in% names(df_all)))
stopifnot(all(task_cols   %in% names(df_tasks)))
stopifnot(all(cov_cols    %in% names(df_cov)))

# ===== FIXED-N LISTWISE DELETION ACROSS ALL VARS =====
mask <- complete.cases(
  df_all[,   region_cols, drop = FALSE],
  df_tasks[, task_cols,   drop = FALSE],
  df_cov[,   cov_cols,    drop = FALSE]
)

df_all   <- df_all[mask, ]
df_tasks <- df_tasks[mask, ]
df_cov   <- df_cov[mask, ]
N_global <- nrow(df_cov)   # same for all tests

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks[[task_cols[i]]]
    y <- df_tasks[[task_cols[j]]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks[[t]]
    y <- df_all[[r]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/ROI_BH_results.csv", row.names = FALSE)
```


# ANTs - fixed N
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized.csv")          # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_tasks.csv")     # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_cov.csv")       # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups (use exact column names) ---
region_cols <- c("RH_Cont_Temp_mean","LH_DorsAttn_PrCv_mean","LH_SalVentAttn_FrOperIns_mean",
  "LH_Limbic_TempPole_mean","RH_Vis_mean","RH_SalVentAttn_FrOperIns_mean",
  "LH_Default_pCunPCC_mean","LH_Default_Par_mean","RH_SalVentAttn_Med_mean",
  "RH_Default_Par_mean","LH_DorsAttn_FEF_mean","RH_Limbic_TempPole_mean",
  "LH_Limbic_OFC_mean","RH_Cont_Cing_mean","LH_SalVentAttn_ParOper_mean",
  "RH_DorsAttn_Post_mean","LH_SomMot_mean","RH_DorsAttn_FEF_mean",
  "RH_Default_pCunPCC_mean","RH_SomMot_mean","LH_DorsAttn_Post_mean",
  "LH_Cont_Par_mean","LH_Cont_Cing_mean","LH_Vis_mean",
  "RH_SalVentAttn_TempOccPar_mean","RH_Default_Temp_mean","RH_Default_PFCv_mean",
  "LH_Default_Temp_mean","RH_Limbic_OFC_mean","RH_Cont_PFCl_mean",
  "LH_Default_PFC_mean","RH_Default_PFCdPFCm_mean","LH_Cont_pCun_mean",
  "LH_SalVentAttn_Med_mean","RH_Cont_Par_mean","RH_Cont_PFCmp_mean",
  "LH_Cont_PFCl_mean","RH_Cont_pCun_mean","LH_Cont_Temp","LH_Cont_PFCmp",
  "LH_SalVentAttn_PFCl","RH_SalVentAttn_PFCl","LH_Cont_OFC")

task_cols   <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
                 "winsorized_iVTT","winsorized_RMT")

cov_cols    <- c("Age","Sex","Volume")

# Quick checks
stopifnot(all(region_cols %in% names(df_all)))
stopifnot(all(task_cols   %in% names(df_tasks)))
stopifnot(all(cov_cols    %in% names(df_cov)))

# ===== FIXED-N LISTWISE DELETION ACROSS ALL VARS =====
mask <- complete.cases(
  df_all[,   region_cols, drop = FALSE],
  df_tasks[, task_cols,   drop = FALSE],
  df_cov[,   cov_cols,    drop = FALSE]
)

df_all   <- df_all[mask, ]
df_tasks <- df_tasks[mask, ]
df_cov   <- df_cov[mask, ]
N_global <- nrow(df_cov)   # same for all tests

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks[[task_cols[i]]]
    y <- df_tasks[[task_cols[j]]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks[[t]]
    y <- df_all[[r]]
    Z <- df_cov[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/ants/BH_results.csv", row.names = FALSE)

```

# ANTs -fixed N - Males
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized.csv")          # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_tasks.csv")     # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_cov.csv")       # Age, Sex

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("RH_Cont_Temp_mean","LH_DorsAttn_PrCv_mean","LH_SalVentAttn_FrOperIns_mean",
  "LH_Limbic_TempPole_mean","RH_Vis_mean","RH_SalVentAttn_FrOperIns_mean",
  "LH_Default_pCunPCC_mean","LH_Default_Par_mean","RH_SalVentAttn_Med_mean",
  "RH_Default_Par_mean","LH_DorsAttn_FEF_mean","RH_Limbic_TempPole_mean",
  "LH_Limbic_OFC_mean","RH_Cont_Cing_mean","LH_SalVentAttn_ParOper_mean",
  "RH_DorsAttn_Post_mean","LH_SomMot_mean","RH_DorsAttn_FEF_mean",
  "RH_Default_pCunPCC_mean","RH_SomMot_mean","LH_DorsAttn_Post_mean",
  "LH_Cont_Par_mean","LH_Cont_Cing_mean","LH_Vis_mean",
  "RH_SalVentAttn_TempOccPar_mean","RH_Default_Temp_mean","RH_Default_PFCv_mean",
  "LH_Default_Temp_mean","RH_Limbic_OFC_mean","RH_Cont_PFCl_mean",
  "LH_Default_PFC_mean","RH_Default_PFCdPFCm_mean","LH_Cont_pCun_mean",
  "LH_SalVentAttn_Med_mean","RH_Cont_Par_mean","RH_Cont_PFCmp_mean",
  "LH_Cont_PFCl_mean","RH_Cont_pCun_mean","LH_Cont_Temp","LH_Cont_PFCmp",
  "LH_SalVentAttn_PFCl","RH_SalVentAttn_PFCl","LH_Cont_OFC")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_m   <- df_all[df_cov$Sex == 1, ]
df_tasks_m <- df_tasks[df_cov$Sex == 1, ]
df_cov_m   <- df_cov[df_cov$Sex == 1, ]

mask_m <- complete.cases(df_all_m[,region_cols], df_tasks_m[,task_cols], df_cov_m[,cov_cols])
df_all_m   <- df_all_m[mask_m, ]
df_tasks_m <- df_tasks_m[mask_m, ]
df_cov_m   <- df_cov_m[mask_m, ]
N_global_m <- nrow(df_cov_m)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_m[[task_cols[i]]]
    y <- df_tasks_m[[task_cols[j]]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_m[[t]]
    y <- df_all_m[[r]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/ants/Males_BH_results.csv", row.names = FALSE)

```

# ANTs -fixed N - Females
```{r}
library(ppcor)

# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized.csv")          # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_tasks.csv")     # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/ants_ct_40_winsorized_cov.csv")       # Age, Sex

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("RH_Cont_Temp_mean","LH_DorsAttn_PrCv_mean","LH_SalVentAttn_FrOperIns_mean",
  "LH_Limbic_TempPole_mean","RH_Vis_mean","RH_SalVentAttn_FrOperIns_mean",
  "LH_Default_pCunPCC_mean","LH_Default_Par_mean","RH_SalVentAttn_Med_mean",
  "RH_Default_Par_mean","LH_DorsAttn_FEF_mean","RH_Limbic_TempPole_mean",
  "LH_Limbic_OFC_mean","RH_Cont_Cing_mean","LH_SalVentAttn_ParOper_mean",
  "RH_DorsAttn_Post_mean","LH_SomMot_mean","RH_DorsAttn_FEF_mean",
  "RH_Default_pCunPCC_mean","RH_SomMot_mean","LH_DorsAttn_Post_mean",
  "LH_Cont_Par_mean","LH_Cont_Cing_mean","LH_Vis_mean",
  "RH_SalVentAttn_TempOccPar_mean","RH_Default_Temp_mean","RH_Default_PFCv_mean",
  "LH_Default_Temp_mean","RH_Limbic_OFC_mean","RH_Cont_PFCl_mean",
  "LH_Default_PFC_mean","RH_Default_PFCdPFCm_mean","LH_Cont_pCun_mean",
  "LH_SalVentAttn_Med_mean","RH_Cont_Par_mean","RH_Cont_PFCmp_mean",
  "LH_Cont_PFCl_mean","RH_Cont_pCun_mean","LH_Cont_Temp","LH_Cont_PFCmp",
  "LH_SalVentAttn_PFCl","RH_SalVentAttn_PFCl","LH_Cont_OFC")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_f   <- df_all[df_cov$Sex == 0, ]
df_tasks_f <- df_tasks[df_cov$Sex == 0, ]
df_cov_f   <- df_cov[df_cov$Sex == 0, ]

# Example for females:
mask_f <- complete.cases(df_all_f[,region_cols], df_tasks_f[,task_cols], df_cov_f[,cov_cols])
df_all_f   <- df_all_f[mask_f, ]
df_tasks_f <- df_tasks_f[mask_f, ]
df_cov_f   <- df_cov_f[mask_f, ]
N_global_f <- nrow(df_cov_f)

# (… run loops again …)
# Save to "ROI_BH_results_Male.csv"
# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_f[[task_cols[i]]]
    y <- df_tasks_f[[task_cols[j]]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_f[[t]]
    y <- df_all_f[[r]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/ants/Females_BH_results.csv", row.names = FALSE)
```


# Freesurfer - all - Males
```{r}
library(ppcor)
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_cov.csv")  

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("rh.caudalanteriorcingulate","rh.caudalmiddlefrontal","rh.cuneus",
  "rh.entorhinal","rh.fusiform","rh.inferiorparietal","rh.inferiortemporal",
  "rh.isthmuscingulate","rh.lateraloccipital","rh.lateralorbitofrontal",
  "rh.lingual","rh.medialorbitofrontal","rh.middletemporal",
  "rh.parahippocampal","rh.paracentral","rh.parsopercularis","rh.parsorbitalis",
  "rh.parstriangularis","rh.pericalcarine","rh.postcentral",
  "rh.posteriorcingulate","rh.precentral","rh.precuneus",
  "rh.rostralanteriorcingulate","rh.rostralmiddlefrontal","rh.superiorfrontal",
  "rh.superiorparietal","rh.superiortemporal","rh.supramarginal",
  "rh.frontalpole","rh.temporalpole","rh.transversetemporal","rh.insula",
  "lh.caudalanteriorcingulate","lh.caudalmiddlefrontal","lh.cuneus",
  "lh.entorhinal","lh.fusiform","lh.inferiorparietal","lh.inferiortemporal",
  "lh.isthmuscingulate","lh.lateraloccipital","lh.lateralorbitofrontal",
  "lh.lingual","lh.medialorbitofrontal","lh.middletemporal",
  "lh.parahippocampal","lh.paracentral","lh.parsopercularis","lh.parsorbitalis",
  "lh.parstriangularis","lh.pericalcarine","lh.postcentral",
  "lh.posteriorcingulate","lh.precentral","lh.precuneus",
  "lh.rostralanteriorcingulate","lh.rostralmiddlefrontal","lh.superiorfrontal",
  "lh.superiorparietal","lh.superiortemporal","lh.supramarginal",
  "lh.frontalpole","lh.temporalpole","lh.transversetemporal","lh.insula")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_m   <- df_all[df_cov$Sex == 1, ]
df_tasks_m <- df_tasks[df_cov$Sex == 1, ]
df_cov_m   <- df_cov[df_cov$Sex == 1, ]

mask_m <- complete.cases(df_all_m[,region_cols], df_tasks_m[,task_cols], df_cov_m[,cov_cols])
df_all_m   <- df_all_m[mask_m, ]
df_tasks_m <- df_tasks_m[mask_m, ]
df_cov_m   <- df_cov_m[mask_m, ]
N_global_m <- nrow(df_cov_m)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_m[[task_cols[i]]]
    y <- df_tasks_m[[task_cols[j]]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_m[[t]]
    y <- df_all_m[[r]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/Males_BH_results.csv", row.names = FALSE)


```


# Freesurfer - all - Females
```{r}
library(ppcor)
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_all_winsorized_cov.csv")  

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("rh.caudalanteriorcingulate","rh.caudalmiddlefrontal","rh.cuneus",
  "rh.entorhinal","rh.fusiform","rh.inferiorparietal","rh.inferiortemporal",
  "rh.isthmuscingulate","rh.lateraloccipital","rh.lateralorbitofrontal",
  "rh.lingual","rh.medialorbitofrontal","rh.middletemporal",
  "rh.parahippocampal","rh.paracentral","rh.parsopercularis","rh.parsorbitalis",
  "rh.parstriangularis","rh.pericalcarine","rh.postcentral",
  "rh.posteriorcingulate","rh.precentral","rh.precuneus",
  "rh.rostralanteriorcingulate","rh.rostralmiddlefrontal","rh.superiorfrontal",
  "rh.superiorparietal","rh.superiortemporal","rh.supramarginal",
  "rh.frontalpole","rh.temporalpole","rh.transversetemporal","rh.insula",
  "lh.caudalanteriorcingulate","lh.caudalmiddlefrontal","lh.cuneus",
  "lh.entorhinal","lh.fusiform","lh.inferiorparietal","lh.inferiortemporal",
  "lh.isthmuscingulate","lh.lateraloccipital","lh.lateralorbitofrontal",
  "lh.lingual","lh.medialorbitofrontal","lh.middletemporal",
  "lh.parahippocampal","lh.paracentral","lh.parsopercularis","lh.parsorbitalis",
  "lh.parstriangularis","lh.pericalcarine","lh.postcentral",
  "lh.posteriorcingulate","lh.precentral","lh.precuneus",
  "lh.rostralanteriorcingulate","lh.rostralmiddlefrontal","lh.superiorfrontal",
  "lh.superiorparietal","lh.superiortemporal","lh.supramarginal",
  "lh.frontalpole","lh.temporalpole","lh.transversetemporal","lh.insula")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_f   <- df_all[df_cov$Sex == 0, ]
df_tasks_f <- df_tasks[df_cov$Sex == 0, ]
df_cov_f   <- df_cov[df_cov$Sex == 0, ]

mask_f <- complete.cases(df_all_f[,region_cols], df_tasks_f[,task_cols], df_cov_f[,cov_cols])
df_all_f   <- df_all_f[mask_f, ]
df_tasks_f <- df_tasks_f[mask_f, ]
df_cov_f   <- df_cov_f[mask_f, ]
N_global_f <- nrow(df_cov_f)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_f[[task_cols[i]]]
    y <- df_tasks_f[[task_cols[j]]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_f[[t]]
    y <- df_all_f[[r]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/Females_BH_results.csv", row.names = FALSE)

```


# Freesurfer - ROI - Males
```{r}
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_cov.csv")  # Age, Sex, Volume (ICV)
# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("rh.supramarginal","rh.precuneus","rh.precentral","rh.nferiorparietal",
  "rh.isthmuscingulate","rh.superiorparietal","rh.superiortemporal",
  "rh.posteriorcingulate","lh.supramarginal","lh.precuneus","lh.precentral",
  "lh.nferiorparietal","lh.isthmuscingulate","lh.superiorparietal",
  "lh.superiortemporal","lh.posteriorcingulate")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_m   <- df_all[df_cov$Sex == 1, ]
df_tasks_m <- df_tasks[df_cov$Sex == 1, ]
df_cov_m   <- df_cov[df_cov$Sex == 1, ]

mask_m <- complete.cases(df_all_m[,region_cols], df_tasks_m[,task_cols], df_cov_m[,cov_cols])
df_all_m   <- df_all_m[mask_m, ]
df_tasks_m <- df_tasks_m[mask_m, ]
df_cov_m   <- df_cov_m[mask_m, ]
N_global_m <- nrow(df_cov_m)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_m[[task_cols[i]]]
    y <- df_tasks_m[[task_cols[j]]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_m[[t]]
    y <- df_all_m[[r]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/ROI_Males_BH_results.csv", row.names = FALSE)

```


# Freesurfer - ROI - Females
```{r}
library(ppcor)
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/fs_CT_roi_winsorized_cov.csv")  # Age, Sex, Volume (ICV) 

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("rh.supramarginal","rh.precuneus","rh.precentral","rh.nferiorparietal",
  "rh.isthmuscingulate","rh.superiorparietal","rh.superiortemporal",
  "rh.posteriorcingulate","lh.supramarginal","lh.precuneus","lh.precentral",
  "lh.nferiorparietal","lh.isthmuscingulate","lh.superiorparietal",
  "lh.superiortemporal","lh.posteriorcingulate")

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_f   <- df_all[df_cov$Sex == 0, ]
df_tasks_f <- df_tasks[df_cov$Sex == 0, ]
df_cov_f   <- df_cov[df_cov$Sex == 0, ]

mask_f <- complete.cases(df_all_f[,region_cols], df_tasks_f[,task_cols], df_cov_f[,cov_cols])
df_all_f   <- df_all_f[mask_f, ]
df_tasks_f <- df_tasks_f[mask_f, ]
df_cov_f   <- df_cov_f[mask_f, ]
N_global_f <- nrow(df_cov_f)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_f[[task_cols[i]]]
    y <- df_tasks_f[[task_cols[j]]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_f[[t]]
    y <- df_all_f[[r]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/freesurfer/ROI_Females_BH_results.csv", row.names = FALSE)

```


# GMV - all - Males
```{r}
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_cov.csv")  # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("LHC","LCA1","LCA2.3","LDG","LSUB", "LERC","LPRC", "LPHC",
                 "RHC", "RCA1", "RCA2.3", "RDG", "RSUB", "RERC", 
                 "RPRC", "RPHC", "TotHC") 

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   

# --- Split dataframes ---
df_all_m   <- df_all[df_cov$Sex == 1, ]
df_tasks_m <- df_tasks[df_cov$Sex == 1, ]
df_cov_m   <- df_cov[df_cov$Sex == 1, ]

mask_m <- complete.cases(df_all_m[,region_cols], df_tasks_m[,task_cols], df_cov_m[,cov_cols])
df_all_m   <- df_all_m[mask_m, ]
df_tasks_m <- df_tasks_m[mask_m, ]
df_cov_m   <- df_cov_m[mask_m, ]
N_global_m <- nrow(df_cov_m)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_m[[task_cols[i]]]
    y <- df_tasks_m[[task_cols[j]]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_m[[t]]
    y <- df_all_m[[r]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/Males_BH_results.csv", row.names = FALSE)

```

# GMV - all - Females
```{r}
library(ppcor)
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_cov.csv")  # Age, Sex, Volume (ICV)
 

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("LHC","LCA1","LCA2.3","LDG","LSUB", "LERC","LPRC", "LPHC",
                 "RHC", "RCA1", "RCA2.3", "RDG", "RSUB", "RERC", 
                 "RPRC", "RPHC", "TotHC") 

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_f   <- df_all[df_cov$Sex == 0, ]
df_tasks_f <- df_tasks[df_cov$Sex == 0, ]
df_cov_f   <- df_cov[df_cov$Sex == 0, ]

mask_f <- complete.cases(df_all_f[,region_cols], df_tasks_f[,task_cols], df_cov_f[,cov_cols])
df_all_f   <- df_all_f[mask_f, ]
df_tasks_f <- df_tasks_f[mask_f, ]
df_cov_f   <- df_cov_f[mask_f, ]
N_global_f <- nrow(df_cov_f)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_f[[task_cols[i]]]
    y <- df_tasks_f[[task_cols[j]]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_f[[t]]
    y <- df_all_f[[r]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/ROI_Females_BH_results.csv", row.names = FALSE)

```


# GMV - ROI - Males
```{r}
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_cov.csv")  # Age, Sex, Volume (ICV)

# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("LCA2.3","LDG","RCA2.3","RDG")   

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   

# --- Split dataframes ---
df_all_m   <- df_all[df_cov$Sex == 1, ]
df_tasks_m <- df_tasks[df_cov$Sex == 1, ]
df_cov_m   <- df_cov[df_cov$Sex == 1, ]

mask_m <- complete.cases(df_all_m[,region_cols], df_tasks_m[,task_cols], df_cov_m[,cov_cols])
df_all_m   <- df_all_m[mask_m, ]
df_tasks_m <- df_tasks_m[mask_m, ]
df_cov_m   <- df_cov_m[mask_m, ]
N_global_m <- nrow(df_cov_m)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_m[[task_cols[i]]]
    y <- df_tasks_m[[task_cols[j]]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_m[[t]]
    y <- df_all_m[[r]]
    Z <- df_cov_m[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_m)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/Males_BH_results.csv", row.names = FALSE)
```


# GMV - ROI - Females
```{r}
library(ppcor)
# --- Load data ---
df_all   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi.csv")  # regions + tasks (same subjects/order)
df_tasks <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_tasks.csv")  # tasks only     (same subjects/order)
df_cov   <- read.csv("E:/liz/Defense/Neuroimaging/hippo_subfields_roi_cov.csv")  # Age, Sex, Volume (ICV)


# --- Remove ID column if it exists ---
df_all   <- df_all[,  !(names(df_all)   %in% "ID")]
df_tasks <- df_tasks[,!(names(df_tasks) %in% "ID")]
df_cov   <- df_cov[,  !(names(df_cov)   %in% "ID")]

# Recode Sex
df_cov$Sex <- ifelse(df_cov$Sex == "M", 1, 0)

# --- Define groups ---
region_cols <- c("LCA2.3","LDG","RCA2.3","RDG") 

task_cols <- c("winsorized_MRT","winsorized_PFT","winsorized_SOT",
               "winsorized_iVTT","winsorized_RMT")

cov_cols <- c("Age","Volume")   # drop Sex here (since you split by it)

# --- Split dataframes ---
df_all_f   <- df_all[df_cov$Sex == 0, ]
df_tasks_f <- df_tasks[df_cov$Sex == 0, ]
df_cov_f   <- df_cov[df_cov$Sex == 0, ]

mask_f <- complete.cases(df_all_f[,region_cols], df_tasks_f[,task_cols], df_cov_f[,cov_cols])
df_all_f   <- df_all_f[mask_f, ]
df_tasks_f <- df_tasks_f[mask_f, ]
df_cov_f   <- df_cov_f[mask_f, ]
N_global_f <- nrow(df_cov_f)

# --- Containers for results ---
labs <- c(); pvec <- c(); rho <- c(); Ns <- c()

# --- TASK–TASK (unique pairs, fixed N) ---
for (i in 1:(length(task_cols)-1)) {
  for (j in (i+1):length(task_cols)) {
    x <- df_tasks_f[[task_cols[i]]]
    y <- df_tasks_f[[task_cols[j]]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(task_cols[i], " vs ", task_cols[j]))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- TASK–REGION (all pairs, fixed N) ---
for (t in task_cols) {
  for (r in region_cols) {
    x <- df_tasks_f[[t]]
    y <- df_all_f[[r]]
    Z <- df_cov_f[, cov_cols, drop = FALSE]

    res <- pcor.test(x, y, Z, method = "spearman")
    labs <- c(labs, paste0(t, " vs ", r))
    pvec <- c(pvec, res$p.value)
    rho  <- c(rho,  res$estimate)
    Ns   <- c(Ns,   N_global_f)
  }
}

# --- Multiple-comparisons correction (one family across all tests) ---
fdr_p <- p.adjust(pvec, method = "BH")

results <- data.frame(
  Comparison = labs,
  Rho        = rho,
  N          = Ns,
  Raw_p      = pvec,
  FDR_p      = fdr_p,
  stringsAsFactors = FALSE
)

write.csv(results, "E:/liz/Defense/Neuroimaging/GMV/ROI_Females_BH_results.csv", row.names = FALSE)

```

